\chapter{Software de clustering existent}

\section{Necessitats generals}

\subsection {A nivell de cluster...}
\begin{itemize}
\item Consultar quantitat de nodes del cluster
\item Consultar carrega total del cluster
\end{itemize}

\subsection {A nivell de node...}
\begin{itemize}
\item Quantitat de CPU's d'un node
\item Consultar càrrega del node
\item Consultar estat de memòria
\item Bloquejar l'arribada de nous processos remots
\item Bloquejar la migracio de processos locals
\item Activar/Desactivar la migració automatica de processos
\item Demanar que els processos que ha creat un node i han migrat, tornin  a
aquest node (come back home)
\item Expulsar els "processos convidats" a casa
\item Saber quin identificador te un node
\item Modificar/Consultar la velocitat d'un node
\item Consultar informacio de processos (resum de l'estat de processos locals, i
remots)
\item Consultar resum de l'estat del node
\end{itemize}

\subsection {A nivell de proces...}
\begin{itemize}
\item Moure processos d'un node a un altre \\
	=> Esborrar els fitxers relatius al proces del node origen \\
	=> Generar els fitxers relatius al proces al node desti
\item Bloquejar un proces en un node concret
\item Crear un nou proces en una maquina (crear un fitxer) \\
	=> Generar els fitxers relatius al proces en aquest node.
\item Matar un proces (esborrar un fitxer) \\
	=> Esborrar els fitxers relatius al proces al node on s'esta executant.
\item Copiar un proces (arrencar una nova execució del programa)
\item Modificar/veure memoria del proces
\item Consultar la linia de comandes amb la que s'ha executat
\item Consultar estat del proces
\item Consultar quants cops s'ha migrat el proces
\item Consultar on s'esta computant actualment
\item Consultar quin node el va crear
\item Saber l'identificador de proces (ID global)
\item Saber l'identificador local d'un proces (ex: PID)
\item Consultar resum de us de CPU
\item Consultar resum de us de Memoria
\end{itemize}


\section{Com es pot fer en ... ?}
                
\subsection{Linux}

\subsubsection{OpenMosix}

El software que volem contruïr està lligat al node on s'executa per la definició
de l'arquitectura d'OpenMosix, fem diferència entre node local i nodes remots.

El node local és aquell on s'executa el nostre software (i davant del qual es
troba l'usuari), la resta són els nodes remots.

Per aquest motiu, suposarem que tots els processos tenen com a punt d'entrada
(s'inicia la seva execució) en el node local (que és la solució adoptada en la
majoria dels centres on s'utilitza OpenMosix).

Fem aquesta suposició precisament perquè els processos que tenen un node
\textit{home} (el node des d'on es llencen) diferent del node local ofereixen
menys possibilitats d'administració i monitorització.


\begin{enumerate}
\item A nivell de cluster...
\begin{itemize}
\item Consultar quantitat de nodes del cluster \\
	Consultant el numero de subdirectoris de tipus NODE del directori cluster.
\item Consultar carrega total del cluster \\
	Mitjana ponderada de la carrega dels nodes que conte el cluster.
\end{itemize}

\item A nivell de node...
\begin{itemize}
\item Quantitat de CPU's d'un node \\
	Consultant el fitxer /proc/hpc/nodes/\textless opMosix\_ID\textgreater/cpus
\item Consultar carrega del node \\
	Consultant el fitxer /proc/hpc/nodes/\textless opMosix\_ID\textgreater/load
\item Consultar estat de memoria \\
	Consultant el fitxer /proc/hpc/nodes/\textless opMosix\_ID\textgreater/mem
\item Bloquejar l'arribada de nous processos remots (tant el node local com els
altres) \\
	Consultant el fitxer /proc/hpc/admin/block
\item Bloquejar la migracio de processos locals \\
	Bloquejar cada procés del node (mirar següent secció)
\item Activar/Desactivar la migració automatica de processos \\
	Modificar el fitxer /proc/hpc/admin/stay
\item Demanar que els processos que ha creat un node i han migrat, tornin  a
aquest node (come back home) \\
	Modificar el fitxer /proc/hpc/admin/bring
\item Expulsar els "processos convidats" a casa \\
	Modificar el fitxer /proc/hpc/admin/expel
\item Saber quin identificador té un node \\
	Consultar el fitxer /proc/hpc/admin/mospe (o mirar el nom del directori del
node)
\item Modificar/Consultar la velocitat d'un node \\
	Consultar el fitxer /proc/hpc/admin/speed
\item Consultar informacio de processos (resum de l'estat de processos locals, i
remots) \\
	Generar un resum consultant la informació de cada procés del node amb les
operacions de consulta de informació de proces (mirar següent secció)
\item Consultar resum de l'estat del node \\
	Generar un resum amb la informació sobre el node descrita a les funcionalitats
anteriors.
\end{itemize}

\item A nivell de proces...
\begin{itemize}
\item Moure processos d'un node a un altre \\
	Fer un \textit{migrate} del proces que volem moure al node on ha d'anar
\item Bloquejar un proces en un node concret \\
	Modificar el fitxer /proc/\textless PID\textgreater/lock
\item Crear un nou proces en una maquina (crear un fitxer) \\
	Posar en execucio el proces al node on volem que s'executi
\item Matar un proces (esborrar un fitxer) \\
	Fer un "kill" del proces
\item Copiar un proces (arrencar una nova execució del programa) \\
	Això no és ofert directament per OpenMosix, sinó que es tracta
	simplement de tornar a executar el programa
\item Modificar/veure memoria del proces \\
	Consultar el fitxer /proc/\textless PID\textgreater/mem
\item Consultar la linia de comandes amb la que s'ha executat \\
	Consultar el fitxer /proc/\textless PID\textgreater/cmdline
\item Consultar estat del proces \\
	Consultar el fitxer /proc/\textless PID\textgreater/status
\item Consultar quants cops s'ha migrat el proces \\
	Consultar el fitxer /proc/\textless PID\textgreater/nmigs
\item Consultar on s'esta computant actualment \\
	Consultar el fitxer /proc/\textless PID\textgreater/where (o mirar el directori pare)
\item Consultar quin node va crear el proces \\
	Segons la suposició inicial, tots es creen al node local
\item Saber l'identificador de proces (ID global) \\
	El propi \textit{PID} ens serveix d'ID global perquè el propi OpenMosix
	ja s'encarrega de mantenir la coherència
\item Saber l'identificador local d'un proces \\
	En OpenMosix tots els identificadors dels processos migrables són
	globals, de forma que ja són els mateixos que els locals (es troben a
	/proc/\textless PID\textgreater)
\item Consultar resum de ús de CPU \\
	Per locals -> top -p PID \\
	Per remots -> consultar fitxer /proc/hpc/remote/stats
\item Consultar resum de us de Memòria \\
	Ídem que l'anterior
\end{itemize}
\end{enumerate} 


\subsubsection{Beowulf}
\nocite{Beowulf-MiniHowto}
Tal com s'ha explicat anteriorment, Beowulf és una arquitectura i no un paquet
de software, de manera que hi ha diverses eines o distribucions que permeten
contruïr aquesta arquitectura:

\begin{itemize}
\item Cluster Management Utility (CMU) de Compaq
\item Projecte OSCAR (Open Source Cluster Application Resources)
\item ROCKS Clustering Toolkit.
\item Patagonia Cluster Project
\item SMILE Cluster Management System (SCMS) i les seves eines per a Beowulf
\item Projecte SCore Cluster System Software (Score)
\item Software ALINKA Linux Clustering
\end{itemize} 

Degut a la gran varietat d'eines d'administració i de sistemes de comunicació
que utilitzen els programadors (PVM, MPI, etc.) en aquesta arquitectura
(precisament per ser una arquitectura i no un software concret), no ens ha estat
possible definir les característiques concretes de Beowulf i, per tant, en la
resta del treball ens basarem en les experiències concretes d'OpenMosix i la
teoria sobre el que ofereix un sistema de computació distribuïda.


\subsection{Microkernels (Mach/L4)}
Tal com s'ha explicat a l'apartat 2, els clústers existents sobre Microkernels
segueixen la mateixa arquitectura que BeoWulf, no existeix cap tipus d'estàndard
ni d'API que ens serveixi per definir les característiques concretes de clústers
en Microkernels, ja que totes les implementacions que hem trobat són a nivell
d'investigació i/o recerca.

