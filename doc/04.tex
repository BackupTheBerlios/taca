\chapter {Estudis i propostes de disseny}

\section{Relació del sistema amb el seu entorn}

Donat que OpenMosix ha estat l'únic software de clustering mitjanament accessible
i documentat que hem trobat, els nostres dissenys estan recolzats en exemples
sobre aquest software de clustering.

\subsection{Disseny simple}

En aquest disseny es tracta d'utilitzar des del mòdul TACA les comandes que
ofereix el software de clustering.

Per exemple, quan es vol migrar un procés, es a dir, es vol moure un fitxer que
representa el procés en el sistema de fitxers que ofereix TACA, d'un node a un
altre, el que faria el software del nostre mòdul seria utilitzar la comanda
\texttt{migrate} de les \textit{OpenMosix Tools} (utilitats de clustering).

L'esquema de l'entorn seria el que s'indica a la figura \ref{fig:esquema-simple}.

\begin{figure}[h]
   \centering
   \includegraphics[scale=0.3]{esquema-simple.eps}
   \caption{Esquema del disseny simple}
   \label{fig:esquema-simple}
\end{figure}


\subsection{Disseny intermig}

En aquest disseny es tracta d'utilitzar des del mòdul TACA les funcions que
ofereix la llibreria del cluster (suport de clustering).

A l'exemple d'abans, en el qual volíem migrar un procés, el nostre mòdul
utilitzaria les funcions específiques per aquesta tasca que trobem a la pròpia
API que ens ofereix OpenMosix. Es a dir, faria servir les funcions que utilitzen
les OpenMosix Tools.

Aquest disseny, respecte l'anterior, aporta independència respecte les OpenMosix
Tools i eficiència ja que no cal que cada cop que volem fer alguna operació
hagim de crear un procés que executi una comanda de les utilitats de
clustering.

Per contra implica entendre les utilitats d'OpenMosix i realitzar una
implementació basada en les crides a sistema que aquestes utilitzen, ja que
al tenir el codi font podem seguir els passos que fan servir (veure figura
\ref{fig:esquema-intermig}).

\begin{figure}[h]
   \centering
   \includegraphics[scale=0.3]{esquema-intermig.eps}
   \caption{Esquema del disseny intermig}
   \label{fig:esquema-intermig}
\end{figure}


\subsection{Disseny complex}

En aquest disseny es tracta d'interectuar directament amb el nucli mitjançant
el sistema de fitxers virtual /proc, que és des d'on OpenMosix ofereix totes les
seves funcionalitats.

Seguint amb l'exemple de migració de procés, en aquest cas es tractaria
d'escriure directament les dades necessàries al fitxer corresponent del
directori /proc. En aquest cas escrivint el identificador de node al fitxer
\texttt{/proc/\textless PID\textgreater/goto} aconseguiríem migrar el procés de
pid=PID al node desitjat. 

Aquest disseny, respecte l'anterior, aporta simplicitat i independència respecte
les utilitats que ofereix el cluster i les llibreries. Però per contra s'hauria
de reescriure molt codi, per exemple pel control d'errors, permisos, etc. que ja
estan implementats a les llibreries del software de clustering (veure figura
\ref{fig:esquema-complex}).

\begin{figure}[hp]
   \centering
   \includegraphics[scale=0.3]{esquema-complex.eps}
   \caption{Esquema del disseny complex}
   \label{fig:esquema-complex}
\end{figure}


\section {Disseny esquemàtic de l'arquitectura}

Hem pensat que el nostre sistema tindria un disseny a dues capes, tal com
apareix a la figura \ref{fig:esquema-arquitectura}.

\begin{figure}[hp]
   \centering
   \includegraphics[scale=0.3]{esquema-arquitectura.eps}
   \caption{Esquema de l'arquitectura}
   \label{fig:esquema-arquitectura}
\end{figure}


\subsection{Frontend}

És la implementació de la jerarquia genèrica de fitxers d'administració a través de
les funcions que proporciona l'abstracció del sistema de fitxers sobre el que
s'executa la nostra arquitectura.

Per exemple: en linux es tractaria d'implementar un sistema de fitxers virtual
sobre l'abstracció del sistema de fitxers que proporciona (VFS).


\subsubsection{Esquema del sistema de fitxers}

Com que volem crear una abstracció (genèrica) a través del sistema de fitxers, a
continuació definirem quina serà l'estructura de la jerarquia de fitxers i
directoris per donar suport a totes les tasques d'administració necessàries
partint de les necessitats generals definides en el capítol \ref{cha-soft}.

Entendrem com a '/' (arrel) l'inici de la nostra jerarquia d'administració.

\begin{verbatim}
/
`-- <IDCluster>
    |-- admin
    |   |-- nnodes           Nombre de nodes al cluster
    |   `-- load             Càrrega general del cluster
    |-- self                 Enllaç al propi node
    `-- <IDNode>
        |-- admin
        |   |-- ncpu         Numero de CPUs al node
        |   |-- load         Carrega del node
        |   |-- mem          Estat de la memòria
        |   |-- block_new    Bloqueja l'arribada de processos nous
        |   |-- block_mig    Bloqueja la migració de processos locals
        |   |-- auto_mig     Bloqueja la migració automàtica de processos
        |   |-- come_home    Fa que els processos que ha llençat aquest node tornin
        |   |-- go_home      Expulsar els processos convidats
        |   |-- speed        Velocitat del node
        |   `-- status       Estat del node i dels processos
        `-- <IDprocés>
            |-- <IDthread>
            |   |-- block    Bloqueja el thread en el node actual
            |   |-- status   Estat del thread
            |   |-- nmig     Nombre de vegades que s'ha migrat el thread
            |   |-- home     Node on s'ha creat el thread
            |   |-- stat_cpu Resum d'ús de CPU pel thread
            |   `-- stat_mem Resum d'ús de memòria pel thread
            |-- block        Bloqueja el procés en el node actual
            |-- mem          Memòria del procés
            |-- cmdline      Línia de comandes amb què s'ha arrencat el procés
            |-- status       Estat del procés
            |-- nmig         Nombre de vegades que s'ha migrat el procés
            |-- home         Node on s'ha creat el procés
            |-- stat_cpu     Resum d'ús de CPU pel procés
            `-- stat_mem     Resum d'ús de memòria pel procés
\end{verbatim} 


\subsection{Backend}

És el component encarregat d'interactuar amb el software de clustering segons el
que el \textit{frontend} li comuniqui.

És una capa d'adaptació entre el sistema de fitxers i el software de clustering,
ja que la interfície que implementa l'hem dissenyada nosaltres de forma genèrica
segons el que s'indica al capítol \ref{cha-soft}.

